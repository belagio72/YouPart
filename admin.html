<!DOCTYPE html>
<html lang="bg">
<head>
  <meta charset="UTF-8">
  <title>–ê–¥–º–∏–Ω –ø–∞–Ω–µ–ª</title>
  <style>
    body { font-family: Arial, sans-serif; padding: 20px; background: #f0f0f0; }
    #login-form, #admin-panel { max-width: 900px; margin: auto; background: white; padding: 20px; border-radius: 8px; box-shadow: 0 0 8px #ccc; }
    #admin-panel { display: none; }
    .tab-nav button {
      padding: 10px 20px;
      margin-right: 5px;
      border: none;
      cursor: pointer;
      background: #ddd;
      border-radius: 5px 5px 0 0;
    }
    .tab-nav button.active { background: #fff; border-bottom: 2px solid white; font-weight: bold; }
    .tab-content { display: none; border-top: 1px solid #ccc; padding-top: 15px; }
    .tab-content.active { display: block; }
    .order, .message, .account {
      border: 1px solid #ccc; padding: 10px; margin-bottom: 10px;
      background: #f9f9f9; border-radius: 5px;
    }
    textarea { width: 100%; margin-top: 10px; }
    .order-item {
      margin-top: 10px;
      padding: 10px;
      border: 1px solid #ccc;
    }
    .paid-badge {
      color: green;
      font-weight: bold;
      margin-left: 10px;
    }
  </style>
</head>
<body>

  <div style="margin-bottom: 20px; padding: 15px; background: #f8f8f8; border-radius: 12px; border: 1px solid #ccc;">
    <h3>üéØ –°—ä–∑–¥–∞–π –ª–∏–Ω–∫ –∫—ä–º –ø—Ä–æ–¥—É–∫—Ç –æ—Ç eBay</h3>
    <input type="text" id="ebayInput" placeholder="–ü–æ—Å—Ç–∞–≤–∏ eBay –ª–∏–Ω–∫ —Ç—É–∫" style="width: 50%; padding: 8px;">
    <input type="number" id="customPrice" placeholder="–¶–µ–Ω–∞ —Å –Ω–∞–¥—Ü–µ–Ω–∫–∞ (BGN)" style="width: 20%; padding: 8px; margin-left: 10px;">
    <button onclick="generateResolvedLink()" style="margin-left: 10px;">–ì–µ–Ω–µ—Ä–∏—Ä–∞–π –ª–∏–Ω–∫</button>
    <div id="resultLink" style="margin-top: 10px;"></div>
  </div>



<!-- 1. –§–æ—Ä–º–∞—Ç–∞ –∑–∞ –≤—Ö–æ–¥ –æ—Å—Ç–∞–≤–∞ –ù–ï–ü–†–û–ú–ï–ù–ï–ù–ê -->
<div id="login-form">
  <h2>–í—Ö–æ–¥ –∑–∞ –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä</h2>
  <input id="username" placeholder="–ü–æ—Ç—Ä–µ–±–∏—Ç–µ–ª—Å–∫–æ –∏–º–µ" /><br><br>
  <input id="password" type="password" placeholder="–ü–∞—Ä–æ–ª–∞" /><br><br>
  <button onclick="login()">–í—Ö–æ–¥</button>
  <p id="login-error" style="color: red;"></p>
</div>

<!-- 2. –ê–¥–º–∏–Ω –ø–∞–Ω–µ–ª—ä—Ç –æ—Å—Ç–∞–≤–∞ –ù–ï–ü–†–û–ú–ï–ù–ï–ù (–æ—Å–≤–µ–Ω –±—É—Ç–æ–Ω–∞ –∑–∞ –∏–∑—Ö–æ–¥) -->
<div id="admin-panel">
  <h1>–ê–¥–º–∏–Ω –ø–∞–Ω–µ–ª</h1>
  <button onclick="logout()" style="float:right;">–ò–∑—Ö–æ–¥</button>

  <div class="tab-nav">
    <button class="tab-btn active" onclick="showTab('orders')">–ü–æ—Ä—ä—á–∫–∏</button>
    <button class="tab-btn" onclick="showTab('archive')">–ê—Ä—Ö–∏–≤</button>
    <button class="tab-btn" onclick="showTab('accounts')">–ê–∫–∞—É–Ω—Ç–∏</button>
    <button class="tab-btn" onclick="showTab('settings')">–ù–∞—Å—Ç—Ä–æ–π–∫–∏</button>
  </div>

  <!-- 3. –¢–∞–±–æ–≤–µ—Ç–µ –æ—Å—Ç–∞–≤–∞—Ç –ù–ï–ü–†–û–ú–ï–ù–ï–ù–ò -->
  <div id="orders" class="tab-content active">
    <h2>–ü–æ—Ä—ä—á–∫–∏</h2>
    <div id="orders-list"></div> <!-- –¢—É–∫ —â–µ —Å–µ –ø–æ–∫–∞–∑–≤–∞—Ç –ø–æ—Ä—ä—á–∫–∏—Ç–µ -->
  </div>

  <div id="archive" class="tab-content">
  <h2>–ê—Ä—Ö–∏–≤–∏—Ä–∞–Ω–∏ –ø–æ—Ä—ä—á–∫–∏</h2>
  <div id="archive-list">–ó–∞—Ä–µ–∂–¥–∞–Ω–µ...</div>
</div>

  <div id="accounts" class="tab-content">
    <h2>–ê–∫–∞—É–Ω—Ç–∏</h2>
    <div id="accounts-list">–ó–∞—Ä–µ–∂–¥–∞–Ω–µ...</div>
  </div>

  <div id="settings" class="tab-content">
    <label>Markup (%):</label>
    <input type="number" id="markupInput" step="0.01">
    <button onclick="saveMarkup()">–ó–∞–ø–∞–∑–∏</button> 
  </div>
</div>

<script>
// –§—É–Ω–∫—Ü–∏—è –∑–∞ –∑–∞—Ä–µ–∂–¥–∞–Ω–µ –Ω–∞ —Ç–µ–∫—É—â–∏—è markup –ø—Ä–∏ –æ—Ç–≤–∞—Ä—è–Ω–µ –Ω–∞ —Å—Ç—Ä–∞–Ω–∏—Ü–∞—Ç–∞
function loadMarkup() {
  fetch('/api/settings')
    .then(response => response.json())
    .then(settings => {
      if (settings.markup) {
        // –ü—Ä–µ–æ–±—Ä–∞–∑—É–≤–∞–Ω–µ –æ—Ç –º–Ω–æ–∂–∏—Ç–µ–ª –∫—ä–º –ø—Ä–æ—Ü–µ–Ω—Ç (1.2 ‚Üí 20)
        document.getElementById('markupInput').value = ((settings.markup - 1) * 100).toFixed(2);
      }
    })
    .catch(error => console.error('–ì—Ä–µ—à–∫–∞ –ø—Ä–∏ –∑–∞—Ä–µ–∂–¥–∞–Ω–µ –Ω–∞ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏:', error));
}

// –§—É–Ω–∫—Ü–∏—è –∑–∞ –∑–∞–ø–∞–∑–≤–∞–Ω–µ –Ω–∞ markup
function saveMarkup() {
  const markupInput = document.getElementById('markupInput');
  const markupValue = parseFloat(markupInput.value);
  
  // –í–∞–ª–∏–¥–∞—Ü–∏—è
  if (isNaN(markupValue)) {
    alert('–ú–æ–ª—è –≤—ä–≤–µ–¥–µ—Ç–µ –≤–∞–ª–∏–¥–Ω–æ —á–∏—Å–ª–æ –∑–∞ markup');
    return;
  }

  // –ü—Ä–µ–æ–±—Ä–∞–∑—É–≤–∞–Ω–µ –æ—Ç –ø—Ä–æ—Ü–µ–Ω—Ç –∫—ä–º –º–Ω–æ–∂–∏—Ç–µ–ª (20 ‚Üí 1.2)
  const markupMultiplier = 1 + (markupValue / 100);

  fetch('/api/settings', {
    method: 'POST',
    headers: { 'Content-Type': 'application/json' },
    body: JSON.stringify({ markup: markupMultiplier })
  })
  .then(response => {
    if (response.ok) {
      alert('–ù–∞—Å—Ç—Ä–æ–π–∫–∏—Ç–µ —Å–∞ –∑–∞–ø–∞–∑–µ–Ω–∏ —É—Å–ø–µ—à–Ω–æ!');
      return response.json();
    }
    throw new Error('–ì—Ä–µ—à–∫–∞ –ø—Ä–∏ –∑–∞–ø–∞–∑–≤–∞–Ω–µ');
  })
  .catch(error => {
    console.error('–ì—Ä–µ—à–∫–∞:', error);
    alert('–ì—Ä–µ—à–∫–∞ –ø—Ä–∏ –∑–∞–ø–∞–∑–≤–∞–Ω–µ –Ω–∞ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏—Ç–µ');
  });
}

// –ó–∞—Ä–µ–∂–¥–∞–Ω–µ –Ω–∞ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏—Ç–µ –ø—Ä–∏ –æ—Ç–≤–∞—Ä—è–Ω–µ –Ω–∞ —Å—Ç—Ä–∞–Ω–∏—Ü–∞—Ç–∞
document.addEventListener('DOMContentLoaded', loadMarkup);
</script>

<script>
// 4. –§—É–Ω–∫—Ü–∏–∏—Ç–µ –∑–∞ –≤—Ö–æ–¥/–∏–∑—Ö–æ–¥ –æ—Å—Ç–∞–≤–∞—Ç –ù–ï–ü–†–û–ú–ï–ù–ï–ù–ò
async function login() {
  const user = document.getElementById('username').value;
  const pass = document.getElementById('password').value;
  const res = await fetch('/admin_users.json');
  const users = await res.json();

  const found = users.find(u => u.username === user && u.password === pass);

  if (found) {
    localStorage.setItem('adminLoggedIn', 'true');
    showAdminPanel();
  } else {
    document.getElementById('login-error').innerText = '–ì—Ä–µ—à–Ω–æ –∏–º–µ –∏–ª–∏ –ø–∞—Ä–æ–ª–∞';
  }
}

function logout() {
  localStorage.removeItem('adminLoggedIn');
  location.reload();
}

// 5. –§—É–Ω–∫—Ü–∏–∏—Ç–µ –∑–∞ —Ç–∞–±–æ–≤–µ –æ—Å—Ç–∞–≤–∞—Ç –ù–ï–ü–†–û–ú–ï–ù–ï–ù–ò
function showTab(tabId) {
  document.querySelectorAll('.tab-content').forEach(el => el.classList.remove('active'));
  document.querySelectorAll('.tab-btn').forEach(btn => btn.classList.remove('active'));
  document.getElementById(tabId).classList.add('active');
  event.target.classList.add('active');

  if (tabId === 'orders') fetchOrders();
  if (tabId === 'tab-messages') fetchMessages();
  if (tabId === 'accounts') fetchAccounts();
  if (tabId === 'archive') fetchArchive();
}

function showAdminPanel() {
  document.getElementById('login-form').style.display = 'none';
  document.getElementById('admin-panel').style.display = 'block';
  fetchOrders();
}

// 6. –ù–û–í–ê –§—É–Ω–∫—Ü–∏—è –∑–∞ –∑–∞—Ä–µ–∂–¥–∞–Ω–µ –Ω–∞ –ø–æ—Ä—ä—á–∫–∏—Ç–µ (–ø—Ä–æ–º–µ–Ω–µ–Ω–∞)
async function fetchOrders() {
  const res = await fetch('/admin/orders?_=' + Date.now());
  const data = await res.json();
  const container = document.getElementById('orders-list');
  container.innerHTML = '';

  if (!data.orders || data.orders.length === 0) {
    container.textContent = '–ù—è–º–∞ –ø–æ—Ä—ä—á–∫–∏.';
    return;
  }

  data.orders.forEach(order => {
    const itemsHtml = order.items.map(item => `
      <div class="order-item">
        <p><strong>–ü—Ä–æ–¥—É–∫—Ç:</strong> ${item.title || '‚Äî'}</p>
        <p><strong>–¶–µ–Ω–∞:</strong> ${item.priceBGN || '‚Äî'} –ª–≤. (${item.priceEUR || '‚Äî'} ‚Ç¨)</p>
        <p><strong>–õ–∏–Ω–∫:</strong> <a href="${item.ebayLink}" target="_blank">${item.ebayLink || '‚Äî'}</a></p>
        ${item.image ? `<img src="${item.image}" alt="Product Image" style="max-width:100px;">` : ''}
      </div>
    `).join('');

    const div = document.createElement('div');
    div.className = 'order';
    div.innerHTML = `
      <h3>–ü–æ—Ä—ä—á–∫–∞: ${order.orderNumber || '‚Äî'} 
        
      ${itemsHtml}
      <p><strong>–ò–º–µ:</strong> ${order.name || '‚Äî'}</p>
      <p><strong>–ò–º–µ–π–ª:</strong> ${order.email || '‚Äî'}</p>
      <p><strong>–¢–µ–ª–µ—Ñ–æ–Ω:</strong> ${order.phone || '‚Äî'}</p>
      <p><strong>–ê–¥—Ä–µ—Å:</strong> ${order.address || '‚Äî'}</p>
      <p><strong>–î–∞—Ç–∞:</strong> ${order.date ? new Date(order.date).toLocaleString() : '‚Äî'}</p>
      
      <p><strong>–ë–µ–ª–µ–∂–∫–∞:</strong></p>
      ${order.paymentStatus === '–ø–ª–∞—Ç–µ–Ω–∞' ? '<span class="paid-badge">‚úÖ –ü–ª–∞—Ç–µ–Ω–æ</span>' : ''}
      <textarea onchange="updateNote('${order.orderNumber}', this.value)">${order.note || ''}</textarea>
      
      <br><br>
      <button onclick="archiveOrder('${order.orderNumber}')">–ê—Ä—Ö–∏–≤–∏—Ä–∞–π</button>
    `;

    container.appendChild(div);
  });
}

// 7. –ù–û–í–ò —Ñ—É–Ω–∫—Ü–∏–∏ –∑–∞ –±–µ–ª–µ–∂–∫–∏ –∏ –∞—Ä—Ö–∏–≤–∏—Ä–∞–Ω–µ
async function updateNote(orderNumber, note) {
  try {
    const res = await fetch('/admin/update-note', {
      method: 'POST',
      headers: { 'Content-Type': 'application/json' },
      body: JSON.stringify({ orderNumber, note })
    });
    const result = await res.json();
    if (!result.success) {
      alert('–ì—Ä–µ—à–∫–∞ –ø—Ä–∏ –∑–∞–ø–∏—Å –Ω–∞ –±–µ–ª–µ–∂–∫–∞!');
    }
  } catch (err) {
    console.error('–ì—Ä–µ—à–∫–∞ –ø—Ä–∏ –∑–∞–ø–∏—Å –Ω–∞ –±–µ–ª–µ–∂–∫–∞:', err);
  }
}

async function archiveOrder(orderNumber) {
  if (!confirm('–°–∏–≥—É—Ä–Ω–∏ –ª–∏ —Å—Ç–µ, —á–µ –∏—Å–∫–∞—Ç–µ –¥–∞ –∞—Ä—Ö–∏–≤–∏—Ä–∞—Ç–µ —Ç–∞–∑–∏ –ø–æ—Ä—ä—á–∫–∞?')) return;
  
  try {
    const res = await fetch('/admin/archive', {
      method: 'POST',
      headers: { 'Content-Type': 'application/json' },
      body: JSON.stringify({ orderNumber })
    });
    
    const result = await res.json();
    if (result.success) {
      await fetchOrders();
    } else {
      alert('–ì—Ä–µ—à–∫–∞ –ø—Ä–∏ –∞—Ä—Ö–∏–≤–∏—Ä–∞–Ω–µ: ' + (result.error || '–ù–µ–∏–∑–≤–µ—Å—Ç–Ω–∞ –≥—Ä–µ—à–∫–∞'));
    }
  } catch (err) {
    console.error('–ì—Ä–µ—à–∫–∞ –ø—Ä–∏ –∞—Ä—Ö–∏–≤–∏—Ä–∞–Ω–µ:', err);
    alert('–ì—Ä–µ—à–∫–∞ –ø—Ä–∏ –∞—Ä—Ö–∏–≤–∏—Ä–∞–Ω–µ!');
  }
}

// 8. –û—Å—Ç–∞–Ω–∞–ª–∏—Ç–µ —Ñ—É–Ω–∫—Ü–∏–∏ (–∑–∞ —Å—ä–æ–±—â–µ–Ω–∏—è –∏ –∞–∫–∞—É–Ω—Ç–∏) –æ—Å—Ç–∞–≤–∞—Ç –ù–ï–ü–†–û–ú–ï–ù–ï–ù–ò
async function fetchMessages() {
  const container = document.getElementById('messages-list');
  container.innerHTML = '–ó–∞—Ä–µ–∂–¥–∞–Ω–µ...';

  try {
    const res = await fetch('/admin/messages');
    const data = await res.json();

    if (!data.messages || data.messages.length === 0) {
      container.innerHTML = '–ù—è–º–∞ —Å—ä–æ–±—â–µ–Ω–∏—è.';
      return;
    }

    container.innerHTML = '';
    data.messages.forEach(msg => {
      const thread = document.createElement('div');
      thread.className = 'message';
      thread.innerHTML = `
        <h3>${msg.name} (${msg.contact})</h3>
        <div>${msg.messages.map(m => `<p><strong>${m.from === 'admin' ? '–ê–¥–º–∏–Ω' : '–ö–ª–∏–µ–Ω—Ç'}:</strong> ${m.text}</p>`).join('')}</div>
        <textarea rows="2" placeholder="–í–∞—à–∏—è—Ç –æ—Ç–≥–æ–≤–æ—Ä..."></textarea>
        <button onclick="replyTo('${msg.clientId}', this)">–ò–∑–ø—Ä–∞—Ç–∏ –æ—Ç–≥–æ–≤–æ—Ä</button>
      `;
      container.appendChild(thread);
    });
  } catch (err) {
    container.innerHTML = '‚ö†Ô∏è –ì—Ä–µ—à–∫–∞ –ø—Ä–∏ –∑–∞—Ä–µ–∂–¥–∞–Ω–µ –Ω–∞ —Å—ä–æ–±—â–µ–Ω–∏—è—Ç–∞.';
    console.error(err);
  }
}

async function replyTo(clientId, btn) {
  const textarea = btn.previousElementSibling;
  const text = textarea.value.trim();
  if (!text) return alert('–ú–æ–ª—è, –≤—ä–≤–µ–¥–µ—Ç–µ —Å—ä–æ–±—â–µ–Ω–∏–µ.');

  const res = await fetch('/admin/reply', {
    method: 'POST',
    headers: { 'Content-Type': 'application/json' },
    body: JSON.stringify({ clientId, text })
  });

  const result = await res.json();
  if (result.success) {
    textarea.value = '';
    await fetchMessages();
  } else {
    alert('–ì—Ä–µ—à–∫–∞ –ø—Ä–∏ –∏–∑–ø—Ä–∞—â–∞–Ω–µ –Ω–∞ –æ—Ç–≥–æ–≤–æ—Ä.');
  }
}

async function fetchAccounts() {
  const res = await fetch('/admin_users.json');
  const users = await res.json();
  const container = document.getElementById('accounts-list');
  container.innerHTML = '';

  users.forEach(u => {
    const div = document.createElement('div');
    div.className = 'account';
    div.innerHTML = `
      <h3>${u.username}</h3>
      <p><strong>–ü–∞—Ä–æ–ª–∞:</strong> ${u.password}</p>
    `;
    container.appendChild(div);
  });
}

async function fetchArchive() {
  const container = document.getElementById('archive-list');
  container.innerHTML = '–ó–∞—Ä–µ–∂–¥–∞–Ω–µ...';

  try {
    const res = await fetch('/admin/archive');
    if (!res.ok) throw new Error(`HTTP error! status: ${res.status}`);
    
    const data = await res.json();
    
    // –ü—Ä–æ–≤–µ—Ä–∫–∞ –¥–∞–ª–∏ data.orders —Å—ä—â–µ—Å—Ç–≤—É–≤–∞
    const orders = data.orders || [];
    
    if (orders.length === 0) {
      container.innerHTML = '–ù—è–º–∞ –∞—Ä—Ö–∏–≤–∏—Ä–∞–Ω–∏ –ø–æ—Ä—ä—á–∫–∏.';
      return;
    }

    container.innerHTML = '';
    orders.forEach(order => {
      const itemsHtml = (order.items || []).map(item => `
        <div class="order-item">
          <p><strong>–ü—Ä–æ–¥—É–∫—Ç:</strong> ${item.title || '‚Äî'}</p>
          <p><strong>–¶–µ–Ω–∞:</strong> ${item.priceBGN || '‚Äî'} –ª–≤.</p>
          <p><strong>–õ–∏–Ω–∫:</strong> <a href="${item.ebayLink || '#'}" target="_blank">${item.ebayLink || '‚Äî'}</a></p>
          ${item.image ? `<img src="${item.image}" style="max-width:100px;">` : ''}
        </div>
      `).join('');

      const div = document.createElement('div');
      div.className = 'order';
      div.innerHTML = `
        <h3>–ü–æ—Ä—ä—á–∫–∞: ${order.orderNumber || '‚Äî'}</h3>
        ${itemsHtml}
        <p><strong>–î–∞—Ç–∞:</strong> ${order.date ? new Date(order.date).toLocaleString() : '‚Äî'}</p>
        ${order.note ? `<p><strong>–ë–µ–ª–µ–∂–∫–∞:</strong> ${order.note}</p>` : ''}
      `;
      container.appendChild(div);
    });
  } catch (err) {
    console.error('–ì—Ä–µ—à–∫–∞ –ø—Ä–∏ –∑–∞—Ä–µ–∂–¥–∞–Ω–µ –Ω–∞ –∞—Ä—Ö–∏–≤–∞:', err);
    container.innerHTML = '‚ö†Ô∏è –ì—Ä–µ—à–∫–∞ –ø—Ä–∏ –∑–∞—Ä–µ–∂–¥–∞–Ω–µ –Ω–∞ –∞—Ä—Ö–∏–≤–∞.';
  }
}

// 9. –ü—Ä–æ–≤–µ—Ä–∫–∞ –∑–∞ –ª–æ–≥–∏–Ω –ø—Ä–∏ –∑–∞—Ä–µ–∂–¥–∞–Ω–µ –æ—Å—Ç–∞–≤–∞ –ù–ï–ü–†–û–ú–ï–ù–ï–ù–ê
if (localStorage.getItem('adminLoggedIn') === 'true') {
  showAdminPanel();
  fetchOrders();
}
async function loadSettings() {
  const res = await fetch('/api/settings');
  const data = await res.json();
  document.getElementById('markupInput').value = data.markup;
}

async function saveMarkup() {
  const markup = parseFloat(document.getElementById('markupInput').value);
  console.log('üì§ –ò–∑–ø—Ä–∞—â–∞–º markup:', markup);

  const res = await fetch('/api/settings', {
    method: 'POST',
    headers: { 'Content-Type': 'application/json' },
    body: JSON.stringify({ markup })
  });

  const text = await res.text(); // üëà –ø—Ä–æ—á–∏—Ç–∞–º–µ –≥–æ –∫–∞—Ç–æ —Ç–µ–∫—Å—Ç (–Ω–µ –¥–∏—Ä–µ–∫—Ç–Ω–æ JSON)
  console.log('üì• –û—Ç–≥–æ–≤–æ—Ä –æ—Ç —Å—ä—Ä–≤—ä—Ä–∞:', text);

  try {
    const result = JSON.parse(text);
    if (result.success) {
      alert('‚úÖ –ù–∞—Å—Ç—Ä–æ–π–∫–∞—Ç–∞ –µ –∑–∞–ø–∞–∑–µ–Ω–∞!');
    } else {
      alert('‚ùå –ì—Ä–µ—à–∫–∞ –ø—Ä–∏ –∑–∞–ø–∏—Å: ' + result.error);
    }
  } catch (e) {
    console.error('‚ùå –ì—Ä–µ—à–∫–∞ –ø—Ä–∏ JSON.parse:', e.message);
    alert('‚ùå –ù–µ–≤–∞–ª–∏–¥–µ–Ω –æ—Ç–≥–æ–≤–æ—Ä –æ—Ç —Å—ä—Ä–≤—ä—Ä–∞');
  }
}


</script>

  <script>
    if (!localStorage.getItem('adminLoggedIn')) {
      document.body.innerHTML = `
        <div style="padding: 20px;">
          <h2>üîê –ê–¥–º–∏–Ω –≤—Ö–æ–¥</h2>
          <input id="adminUser" placeholder="–ü–æ—Ç—Ä–µ–±–∏—Ç–µ–ª—Å–∫–æ –∏–º–µ"><br><br>
          <input id="adminPass" type="password" placeholder="–ü–∞—Ä–æ–ª–∞"><br><br>
          <button onclick="loginAdmin()">–í—Ö–æ–¥</button>
        </div>
      `;
    }

    async function loginAdmin() {
      const user = document.getElementById('adminUser').value.trim();
      const pass = document.getElementById('adminPass').value.trim();
      try {
        const res = await fetch('/admin_users.json');
        const users = await res.json();
        const match = users.find(u => u.username === user && u.password === pass);
        if (match) {
          localStorage.setItem('adminLoggedIn', 'true');
          location.reload();
        } else {
          alert('‚ùå –ù–µ–≤–∞–ª–∏–¥–Ω–∏ –¥–∞–Ω–Ω–∏ –∑–∞ –≤—Ö–æ–¥');
        }
      } catch (err) {
        console.error('–ì—Ä–µ—à–∫–∞ –ø—Ä–∏ –∑–∞—Ä–µ–∂–¥–∞–Ω–µ –Ω–∞ –ø–æ—Ç—Ä–µ–±–∏—Ç–µ–ª–∏—Ç–µ:', err);
        alert('‚ö†Ô∏è –ü—Ä–æ–±–ª–µ–º –ø—Ä–∏ –ø—Ä–æ–≤–µ—Ä–∫–∞ –Ω–∞ –≤—Ö–æ–¥');
      }
    }
  </script>

  <script>
function generateResolvedLink() {
  const ebayLink = document.getElementById('ebayInput').value.trim();
  const customPrice = parseFloat(document.getElementById('customPrice').value.trim());

  if (!ebayLink.includes('/itm/')) {
    alert('‚ùå –ú–æ–ª—è –≤—ä–≤–µ–¥–∏ –≤–∞–ª–∏–¥–µ–Ω eBay –ª–∏–Ω–∫ (—Å—ä–¥—ä—Ä–∂–∞—â /itm/).');
    return;
  }

  fetch(`/api/resolve-id?url=${encodeURIComponent(ebayLink)}`)
    .then(res => res.json())
    .then(data => {
      if (data.error) {
        document.getElementById('resultLink').innerHTML = `‚ö†Ô∏è ${data.error}`;
        return;
      }

      const { itemId, title, priceBGN, query, region } = data;
      const finalPrice = !isNaN(customPrice) ? customPrice.toFixed(2) : priceBGN;

      const finalUrl = `product.html?id=${encodeURIComponent(itemId)}&title=${encodeURIComponent(title)}&priceBGN=${finalPrice}&query=${encodeURIComponent(query)}&region=${region}`;
      const fullUrl = `${window.location.origin}/${finalUrl}`;

      document.getElementById('resultLink').innerHTML = `
        ‚úÖ –õ–∏–Ω–∫ –∫—ä–º –ø—Ä–æ–¥—É–∫—Ç–∞:<br>
        <a href="${finalUrl}" target="_blank">${fullUrl}</a><br><br>
        <button onclick="copyToClipboard('${fullUrl}')">üìã –ö–æ–ø–∏—Ä–∞–π –ª–∏–Ω–∫–∞</button>
      `;
    })
    .catch(err => {
      console.error('‚ùå –ì—Ä–µ—à–∫–∞ –ø—Ä–∏ –∏–∑–≤–ª–∏—á–∞–Ω–µ –Ω–∞ itemId:', err);
      document.getElementById('resultLink').innerText = '‚ö†Ô∏è –í—ä–∑–Ω–∏–∫–Ω–∞ –≥—Ä–µ—à–∫–∞ –ø—Ä–∏ –æ–±—Ä–∞–±–æ—Ç–∫–∞ –Ω–∞ –ª–∏–Ω–∫–∞.';
    });
}

function copyToClipboard(text) {
  navigator.clipboard.writeText(text).then(() => {
    alert('üîó –õ–∏–Ω–∫—ä—Ç –µ –∫–æ–ø–∏—Ä–∞–Ω!');
  });
}
</script>

</body>
</html>






