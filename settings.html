<!DOCTYPE html>
<html lang="bg">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>–ù–∞—Å—Ç—Ä–æ–π–∫–∏</title>
  <style>
    body { font-family: Arial, sans-serif; padding: 20px; }
    #settingsForm { padding: 20px; border: 1px solid #ccc; border-radius: 8px; background-color: #f2f2f2; max-width: 600px; margin-bottom: 20px; }
    #settingsForm input[type="text"], #settingsForm input[type="number"] { width: 100%; padding: 8px; margin-bottom: 10px; }
    #settingsForm label { font-weight: bold; display: block; margin-top: 10px; }
    #settingsForm button { padding: 10px 20px; font-size: 16px; }
    #currentSettings { background: #e9e9e9; padding: 15px; border-radius: 8px; border: 1px solid #bbb; max-width: 600px; }
    #currentSettings h2 { margin-top: 0; }
    #currentSettings ul { padding-left: 20px; }
  </style>
</head>
<body>
  <h1>–ù–∞—Å—Ç—Ä–æ–π–∫–∏ –Ω–∞ —Å–∞–π—Ç–∞</h1>

  <div id="settingsForm">
    <form onsubmit="return saveSettings()">
      <label for="markup">–ü—Ä–æ—Ü–µ–Ω—Ç –Ω–∞–¥—Ü–µ–Ω–∫–∞ (–Ω–∞–ø—Ä. 1.2 –∑–∞ 20%)</label>
      <input type="number" step="0.01" id="markup" name="markup" required>

      <label for="allowedDomains">–î–æ–ø—É—Å—Ç–∏–º–∏ –¥–æ–º–µ–π–Ω–∏ (–Ω–∞–ø—Ä. .co.uk, .de, .fr)</label>
      <input type="text" id="allowedDomains" name="allowedDomains">

      <label for="excludedSellerCountries">–ò–∑–∫–ª—é—á–µ–Ω–∏ –¥—ä—Ä–∂–∞–≤–∏ –Ω–∞ –ø—Ä–æ–¥–∞–≤–∞—á–∏ (ISO –∫–æ–¥–æ–≤–µ)</label>
      <input type="text" id="excludedSellerCountries" name="excludedSellerCountries">

      <label><input type="checkbox" id="onlyShipToGB"> –ü–æ–∫–∞–∑–≤–∞–π —Å–∞–º–æ –æ–±—è–≤–∏ —Å –¥–æ—Å—Ç–∞–≤–∫–∞ –¥–æ UK</label>

      <label><input type="checkbox" id="enableUrlFilter"> –ê–∫—Ç–∏–≤–∏—Ä–∞–π —Ñ–∏–ª—Ç—ä—Ä –ø–æ URL</label>

      <label><input type="checkbox" id="enableLocationFilter"> –ê–∫—Ç–∏–≤–∏—Ä–∞–π —Ñ–∏–ª—Ç—ä—Ä –ø–æ –ª–æ–∫–∞—Ü–∏—è</label>

      <button type="submit">üíæ –ó–∞–ø–∞–∑–∏</button>
      <p id="saveStatus" style="color:green; display:none;">‚úîÔ∏è –ó–∞–ø–∞–∑–µ–Ω–æ —É—Å–ø–µ—à–Ω–æ!</p>
    </form>
  </div>

  <div id="currentSettings">
    <h2>–¢–µ–∫—É—â–∏ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏</h2>
    <ul id="settingsPreview"></ul>
  </div>

  <script>
    function renderPreview(settings) {
      const list = document.getElementById('settingsPreview');
      list.innerHTML = '';
      list.innerHTML += `<li>–ù–∞–¥—Ü–µ–Ω–∫–∞: <strong>${settings.markup}</strong></li>`;
      list.innerHTML += `<li>–î–æ–ø—É—Å—Ç–∏–º–∏ –¥–æ–º–µ–π–Ω–∏: <strong>${(settings.allowedDomains || []).join(', ')}</strong></li>`;
      list.innerHTML += `<li>–ò–∑–∫–ª—é—á–µ–Ω–∏ –¥—ä—Ä–∂–∞–≤–∏: <strong>${(settings.excludedSellerCountries || []).join(', ')}</strong></li>`;
      list.innerHTML += `<li>–°–∞–º–æ –¥–æ—Å—Ç–∞–≤–∫–∞ –¥–æ UK: <strong>${settings.onlyShipToGB ? '–î–∞' : '–ù–µ'}</strong></li>`;
      list.innerHTML += `<li>–§–∏–ª—Ç—ä—Ä –ø–æ URL: <strong>${settings.enableUrlFilter ? '–ê–∫—Ç–∏–≤–µ–Ω' : '–ò–∑–∫–ª—é—á–µ–Ω'}</strong></li>`;
      list.innerHTML += `<li>–§–∏–ª—Ç—ä—Ä –ø–æ –ª–æ–∫–∞—Ü–∏—è: <strong>${settings.enableLocationFilter ? '–ê–∫—Ç–∏–≤–µ–Ω' : '–ò–∑–∫–ª—é—á–µ–Ω'}</strong></li>`;
    }

    async function loadSettings() {
      try {
        const res = await fetch('/admin/settings');
        const settings = await res.json();

        document.getElementById('markup').value = settings.markup || 1.2;
        document.getElementById('allowedDomains').value = (settings.allowedDomains || []).join(', ');
        document.getElementById('excludedSellerCountries').value = (settings.excludedSellerCountries || []).join(', ');
        document.getElementById('onlyShipToGB').checked = settings.onlyShipToGB || false;
        document.getElementById('enableUrlFilter').checked = settings.enableUrlFilter || false;
        document.getElementById('enableLocationFilter').checked = settings.enableLocationFilter || false;

        renderPreview(settings);
      } catch (err) {
        console.error('‚ö†Ô∏è –ì—Ä–µ—à–∫–∞ –ø—Ä–∏ –∑–∞—Ä–µ–∂–¥–∞–Ω–µ –Ω–∞ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏:', err);
      }
    }

    async function saveSettings() {
      const markup = parseFloat(document.getElementById('markup').value);
      if (isNaN(markup) || markup <= 0) {
        alert('‚ùå –ú–æ–ª—è –≤—ä–≤–µ–¥–µ—Ç–µ –≤–∞–ª–∏–¥–µ–Ω –ø—Ä–æ—Ü–µ–Ω—Ç –Ω–∞–¥—Ü–µ–Ω–∫–∞.');
        return false;
      }

      const allowedDomains = document.getElementById('allowedDomains').value.split(',').map(d => d.trim()).filter(Boolean);
      const excludedSellerCountries = document.getElementById('excludedSellerCountries').value.split(',').map(c => c.trim().toUpperCase()).filter(Boolean);

      const settings = {
        markup,
        allowedDomains,
        excludedSellerCountries,
        onlyShipToGB: document.getElementById('onlyShipToGB').checked,
        enableUrlFilter: document.getElementById('enableUrlFilter').checked,
        enableLocationFilter: document.getElementById('enableLocationFilter').checked
      };

      try {
        await fetch('/admin/settings', {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify(settings)
        });
        document.getElementById('saveStatus').style.display = 'block';
        setTimeout(() => document.getElementById('saveStatus').style.display = 'none', 2000);
        renderPreview(settings);
      } catch (err) {
        console.error('‚ö†Ô∏è –ì—Ä–µ—à–∫–∞ –ø—Ä–∏ –∑–∞–ø–∞–∑–≤–∞–Ω–µ –Ω–∞ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏:', err);
        alert('‚ùå –ù–µ—É—Å–ø–µ—à–Ω–æ –∑–∞–ø–∞–∑–≤–∞–Ω–µ –Ω–∞ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏—Ç–µ.');
      }
      return false;
    }

    loadSettings();
  </script>
</body>
</html>






